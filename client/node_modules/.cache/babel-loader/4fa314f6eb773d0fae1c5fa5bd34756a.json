{"ast":null,"code":"import _slicedToArray from\"/Users/saatvikshrivastava/Downloads/chat/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useContext,useEffect,useRef,useState}from\"react\";import{Button,Col,Form,Row}from\"react-bootstrap\";import{useSelector}from\"react-redux\";import{AppContext}from\"../context/appContext\";import\"./MessageForm.css\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function MessageForm(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),message=_useState2[0],setMessage=_useState2[1];var user=useSelector(function(state){return state.user;});var _useContext=useContext(AppContext),socket=_useContext.socket,currentRoom=_useContext.currentRoom,setMessages=_useContext.setMessages,messages=_useContext.messages,privateMemberMsg=_useContext.privateMemberMsg;var messageEndRef=useRef(null);useEffect(function(){scrollToBottom();},[messages]);function getFormattedDate(){var date=new Date();var year=date.getFullYear();var month=(1+date.getMonth()).toString();month=month.length>1?month:\"0\"+month;var day=date.getDate().toString();day=day.length>1?day:\"0\"+day;return month+\"/\"+day+\"/\"+year;}function handleSubmit(e){e.preventDefault();}function scrollToBottom(){var _messageEndRef$curren;(_messageEndRef$curren=messageEndRef.current)===null||_messageEndRef$curren===void 0?void 0:_messageEndRef$curren.scrollIntoView({behavior:\"smooth\"});}var todayDate=getFormattedDate();socket.off(\"room-messages\").on(\"room-messages\",function(roomMessages){setMessages(roomMessages);});function handleSubmit(e){e.preventDefault();if(!message)return;var today=new Date();var minutes=today.getMinutes()<10?\"0\"+today.getMinutes():today.getMinutes();var time=today.getHours()+\":\"+minutes;var roomId=currentRoom;socket.emit(\"message-room\",roomId,message,user,time,todayDate);setMessage(\"\");}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"messages-output\",children:[user&&!(privateMemberMsg!==null&&privateMemberMsg!==void 0&&privateMemberMsg._id)&&/*#__PURE__*/_jsxs(\"div\",{className:\"alert alert-info\",children:[\"You are in the \",currentRoom,\" room\"]}),user&&(privateMemberMsg===null||privateMemberMsg===void 0?void 0:privateMemberMsg._id)&&/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-info conversation-info\",children:/*#__PURE__*/_jsxs(\"div\",{children:[\"Your conversation with \",privateMemberMsg.name,\" \",/*#__PURE__*/_jsx(\"img\",{src:privateMemberMsg.picture,className:\"conversation-profile-pic\"})]})})}),!user&&/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-danger\",children:\"Please login\"}),user&&messages.map(function(_ref,idx){var date=_ref._id,messagesByDate=_ref.messagesByDate;return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"alert alert-info text-center message-date-indicator\",children:date}),messagesByDate===null||messagesByDate===void 0?void 0:messagesByDate.map(function(_ref2,msgIdx){var content=_ref2.content,time=_ref2.time,sender=_ref2.from;return/*#__PURE__*/_jsx(\"div\",{className:(sender===null||sender===void 0?void 0:sender.email)==(user===null||user===void 0?void 0:user.email)?\"message\":\"incoming-message\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"message-inner\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center mb-3\",children:[/*#__PURE__*/_jsx(\"img\",{src:sender.picture,style:{width:35,height:35,objectFit:\"cover\",borderRadius:\"50%\",marginRight:10}}),/*#__PURE__*/_jsx(\"p\",{className:\"message-sender\",children:sender._id==(user===null||user===void 0?void 0:user._id)?\"You\":sender.name})]}),/*#__PURE__*/_jsx(\"p\",{className:\"message-content\",children:content}),/*#__PURE__*/_jsx(\"p\",{className:\"message-timestamp-left\",children:time})]})},msgIdx);})]},idx);}),/*#__PURE__*/_jsx(\"div\",{ref:messageEndRef})]}),/*#__PURE__*/_jsx(Form,{onSubmit:handleSubmit,children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:11,children:/*#__PURE__*/_jsx(Form.Group,{children:/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"Your message\",disabled:!user,value:message,onChange:function onChange(e){return setMessage(e.target.value);}})})}),/*#__PURE__*/_jsx(Col,{md:1,children:/*#__PURE__*/_jsx(Button,{variant:\"primary\",type:\"submit\",style:{width:\"100%\",backgroundColor:\"orange\"},disabled:!user,children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-paper-plane\"})})})]})})]});}export default MessageForm;","map":{"version":3,"sources":["/Users/saatvikshrivastava/Downloads/chat/client/src/components/MessageForm.js"],"names":["React","useContext","useEffect","useRef","useState","Button","Col","Form","Row","useSelector","AppContext","MessageForm","message","setMessage","user","state","socket","currentRoom","setMessages","messages","privateMemberMsg","messageEndRef","scrollToBottom","getFormattedDate","date","Date","year","getFullYear","month","getMonth","toString","length","day","getDate","handleSubmit","e","preventDefault","current","scrollIntoView","behavior","todayDate","off","on","roomMessages","today","minutes","getMinutes","time","getHours","roomId","emit","_id","name","picture","map","idx","messagesByDate","msgIdx","content","sender","from","email","width","height","objectFit","borderRadius","marginRight","target","value","backgroundColor"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useRef, useState } from \"react\";\nimport { Button, Col, Form, Row } from \"react-bootstrap\";\nimport { useSelector } from \"react-redux\";\nimport { AppContext } from \"../context/appContext\";\nimport \"./MessageForm.css\";\nfunction MessageForm() {\n    const [message, setMessage] = useState(\"\");\n    const user = useSelector((state) => state.user);\n    const { socket, currentRoom, setMessages, messages, privateMemberMsg } = useContext(AppContext);\n    const messageEndRef = useRef(null);\n    useEffect(() => {\n        scrollToBottom();\n    }, [messages]);\n\n    function getFormattedDate() {\n        const date = new Date();\n        const year = date.getFullYear();\n        let month = (1 + date.getMonth()).toString();\n\n        month = month.length > 1 ? month : \"0\" + month;\n        let day = date.getDate().toString();\n\n        day = day.length > 1 ? day : \"0\" + day;\n\n        return month + \"/\" + day + \"/\" + year;\n    }\n\n    function handleSubmit(e) {\n        e.preventDefault();\n    }\n\n    function scrollToBottom() {\n        messageEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n    }\n\n    const todayDate = getFormattedDate();\n\n    socket.off(\"room-messages\").on(\"room-messages\", (roomMessages) => {\n        setMessages(roomMessages);\n    });\n\n    function handleSubmit(e) {\n        e.preventDefault();\n        if (!message) return;\n        const today = new Date();\n        const minutes = today.getMinutes() < 10 ? \"0\" + today.getMinutes() : today.getMinutes();\n        const time = today.getHours() + \":\" + minutes;\n        const roomId = currentRoom;\n        socket.emit(\"message-room\", roomId, message, user, time, todayDate);\n        setMessage(\"\");\n    }\n    return (\n        <>\n            <div className=\"messages-output\">\n                {user && !privateMemberMsg?._id && <div className=\"alert alert-info\">You are in the {currentRoom} room</div>}\n                {user && privateMemberMsg?._id && (\n                    <>\n                        <div className=\"alert alert-info conversation-info\">\n                            <div>\n                                Your conversation with {privateMemberMsg.name} <img src={privateMemberMsg.picture} className=\"conversation-profile-pic\" />\n                            </div>\n                        </div>\n                    </>\n                )}\n                {!user && <div className=\"alert alert-danger\">Please login</div>}\n\n                {user &&\n                    messages.map(({ _id: date, messagesByDate }, idx) => (\n                        <div key={idx}>\n                            <p className=\"alert alert-info text-center message-date-indicator\">{date}</p>\n                            {messagesByDate?.map(({ content, time, from: sender }, msgIdx) => (\n                                <div className={sender?.email == user?.email ? \"message\" : \"incoming-message\"} key={msgIdx}>\n                                    <div className=\"message-inner\">\n                                        <div className=\"d-flex align-items-center mb-3\">\n                                            <img src={sender.picture} style={{ width: 35, height: 35, objectFit: \"cover\", borderRadius: \"50%\", marginRight: 10 }} />\n                                            <p className=\"message-sender\">{sender._id == user?._id ? \"You\" : sender.name}</p>\n                                        </div>\n                                        <p className=\"message-content\">{content}</p>\n                                        <p className=\"message-timestamp-left\">{time}</p>\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n                    ))}\n                <div ref={messageEndRef} />\n            </div>\n            <Form onSubmit={handleSubmit}>\n                <Row>\n                    <Col md={11}>\n                        <Form.Group>\n                            <Form.Control type=\"text\" placeholder=\"Your message\" disabled={!user} value={message} onChange={(e) => setMessage(e.target.value)}></Form.Control>\n                        </Form.Group>\n                    </Col>\n                    <Col md={1}>\n                        <Button variant=\"primary\" type=\"submit\" style={{ width: \"100%\", backgroundColor: \"orange\" }} disabled={!user}>\n                            <i className=\"fas fa-paper-plane\"></i>\n                        </Button>\n                    </Col>\n                </Row>\n            </Form>\n        </>\n    );\n}\n\nexport default MessageForm;\n"]},"metadata":{},"sourceType":"module"}